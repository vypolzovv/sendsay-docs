---
sidebar_position: 1
sidebar_label: 'Как подключить домен'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import SupportLink from '@site/src/components/SupportLink';

# Как подключить домен и настроить email-аутентификацию

## Зачем нужна email-аутентификация

Подключение домена к Sendsay — это часть настройки email-аутентификации. Основная функция аутентификации — защита рассылок от злоумышленников, которые теоретически могут отправить письмо от вашего имени и адреса, подставив своё содержание (это называется фишинг). Разберём подробнее, как это работает.

При отправке писем используются два почтовых адреса:

- адрес отправителя, который вы указываете при создании рассылки и который видят подписчики,
- технический адрес, который находится в скрытой части рассылки (это называется оригинал письма).

Технический адрес можно посмотреть в любой рассылке — например, в Gmail это делается следующим образом:

1. Над текстом письма нажмите на три точки справа от даты получения и в выпадающем меню выберите «Показать оригинал».
2. В открывшемся окне найдите строчку Return-Path.
   ![Return Path](/img/email-campaigns/settings\how-to-connect-domain/return-path.gif) <br/>

По умолчанию в техническом адресе используются адреса с доменов Sendsay — например, mail.sendsay.ru (в ходе аутентификации их можно заменить на ваши адреса). При этом никакой связи между видимым и техническим адресами нет, и при получении рассылки почтовые сервисы не могут установить: действительно ли письмо было отправлено с этого домена через сторонний сервис рассылок или это фишинг.

Сервисы Gmail, Яндекс и Outlook в таких случаях добавляют специальную метку к адресу отправителя:

![Unverified sender](/img/email-campaigns/settings\how-to-connect-domain/unverified-sender.png) <br/>

Email-аутентификация позволяет как минимум верифицировать отправку писем с домена через сервис рассылок — это скроет упоминание Sendsay рядом вашим с адресом. Если у вас небольшая рассылка, и метка вам не мешает, а фишинг вряд ли грозит, то **подключать свой домен необязательно** — можно продолжать отправлять рассылки с адресов Sendsay, никаких негативных последствий это не принесёт и доставляемость не снизит.

## Способы настройки email-аутентификации

Настроить email-аутентификацию можно одним из двух способов:

### 1. Самостоятельно подключить домен через интерфейс

Это неполная настройка аутентификации, но её достаточно, чтобы почтовые сервисы могли установить, что им пришла легальная рассылка от домена в адресе отправителя. Это позволит:

- убрать метку почтовых сервисов рядом с адресом отправителя,
- получить доступ в постмастерах [Mail.Ru](https://postmaster.mail.ru/) и [Gmail](https://gmail.com/postmaster/) к статистике писем, которые отправлены через Sendsay. Постмастеры — это инструменты для подсчёта статистики, у каждого сервиса они свои.

После подключения домена вы также можете самостоятельно настроить, какие серверы могут отправлять рассылки от имени вашего домена.

### 2. Заказать полную настройку

Полную настройку делают наши специалисты, поэтому это платная услуга (точную стоимость настройки можно узнать у вашего менеджера). Полная аутентификация позволяет:

- настроить, какие серверы могут отправлять рассылки от имени вашего домена,
- отправлять письма непосредственно с вашего домена (то есть в скрытом адресе будет также указан ваш технический адрес), чтобы даже в скрытой части письма не было упоминаний стороннего сервиса рассылок.

## Как самостоятельно подключить домен

Чтобы подключить домен, нужно создать запись для нового домена в системе и настроить DKIM-подпись. Это можно сделать как в интерфейсе, так и с помощью запроса в API-консоли — во втором случае вы получите номер DKIM-ключа, который может понадобиться для проверки наличия созданной записи в DNS-зоне.

Как это сделать:

<Tabs>
<TabItem value="key1" label="В интерфейсе Sendsay">

1. В меню аккаунта перейдите в&nbsp;раздел [**Настройки системы → Домены**](https://app.sendsay.ru/account/domains) и&nbsp;нажмите «Добавить домен». Затем введите имя домена без&nbsp;протокола `https` или приставки `www`:

   ![Create new domain](/img/email-campaigns/settings\how-to-connect-domain/create-new-domain.gif)

2. Перейдите на страницу домена и&nbsp;скопируйте имя записи и&nbsp;значение DKIM-подписи:

   ![DKIM-key](/img/email-campaigns/settings/how-to-connect-domain/dkim-key.png)

3. Перейдите в редактор DNS-зоны вашего домена — обычно он находится в&nbsp;интерфейсе хостинг-провайдера или регистратора доменного имени. Если у&nbsp;вас нет доступа к&nbsp;редактированию DNS-записей, обратитесь к&nbsp;вашему системному администратору.

   Создайте TXT-запись со&nbsp;следующими значениями полей (в&nbsp;разных панелях управления названия полей могут отличаться):

   - Хост — имя записи в&nbsp;формате `ваш_логин.xxx._domainkey`.
   - Значение — текст публичного ключа формата `v=DKIM1; k=rsa;p=MIGfMA0GCSEBtaCOteH4EBqJlKpe…`, который вы скопировали.<br/><br/>

   :::tip Важно
   Обратите внимание, что в некоторых панелях управления DNS для публичного ключа DKIM необходимо также указывать домен, например `ваш_логин.xxx._domainkey.ваш_домен.ru` — это зависит от самой панели управления, следуйте внутренним инструкциям.
   :::

4. Проверьте наличие созданной записи в DNS-зоне домена. На странице настройки домена в Sendsay нажмите «Проверить»:

   ![Domain check](/img/email-campaigns/settings/how-to-connect-domain/domain-check.png)

   Когда ключ будет обнаружен, домен перейдёт в&nbsp;статус **Активен** — значит, можно тестировать отправку писем. В случае если после проверки домен остался в&nbsp;статусе **Неактивен**, необходимо проверить список ошибок в&nbsp;API-консоли — и&nbsp;исправить их (см. вкладку **В API-консоли**).

</TabItem>
<TabItem value="key2" label="В API-консоли">

1. Перейдите в [**API-консоль**](https://app.sendsay.ru/api/console) и введите запрос:

   ```js
   {
      "action" : "issue.dkim.create",
      "obj" : {
         "domain" : "mail.ваш_домен.ru" ,
         "keysize" : 2048 ,
         "return_fresh_obj": "1"
      }
   }
   ```

   где `mail.ваш_домен.ru` — имя домена без протокола `https` или приставки `www`.

   Нажмите «Выполнить». В ответе вы получите значение параметра `id` — это номер DKIM-ключа, сохраните его:

   ![DKIM-id](/img/email-campaigns/settings/how-to-connect-domain/dkim-id.png)

2. Затем введите новый запрос:

   ```js
   {
      "action": "issue.dkim.get",
      "id": номер dkim-ключа
   }
   ```

   где `номер dkim-ключа` — id вашего DKIM-ключа, полученный на предыдущем шаге.

   После отправки запроса придёт похожий ответ:

   ![Query response](/img/email-campaigns/settings/how-to-connect-domain/dns-record.png)

   Используйте из ответа значение параметра `dns_record` для внесения в&nbsp;настройки домена, предварительно удалив из&nbsp;него символы косой черты `\` и&nbsp;кавычек `”`. В&nbsp;нашем примере получилось так:

   Имя записи

   ```
   x-156812572583769.386._domainkey.mail.sendsaytest.ru
   ```

   Значение DKIM-подписи

   ```
   v=DKIM1; k=rsa;
   p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAykTz1cx9vPZNR9ldvGJ7bz88JCLt3/dywdEN8JfBg3Lb+gUFhVjYYQR7LRS8jzNAqGCIHl1V/m9sgysv4bgQaBAAqOQGsvwTFLHOUpJUs2PL2RwpfRBxWVB3e3r0SeZuUF+1kflpTz3MWckxSo9oTRm6wrfHuh6xq3rs/B4Qs6nYJRb2LTOCz1o9IUM4tEbi5LoeXt8ixSxBMyWxXDkV+DhkH/QyR6pd0CYE5lQtu9BaQC2Vpt+zt3LIjtXgYgZFUDefh67elSh2wbH4bGOAOqUOVrJW1HSPAOFBZmOsUlZZ2nWD8pzVPYEHh1hA+dMmge2QYrfar61k7lgCTY8tхххххххх
   ```

3. Перейдите в редактор DNS-зоны вашего домена — обычно он находится в&nbsp;интерфейсе хостинг-провайдера или регистратора доменного имени. Если у&nbsp;вас нет доступа к&nbsp;редактированию DNS-записей, обратитесь к&nbsp;вашему системному администратору.

   Создайте TXT-запись со&nbsp;следующими значениями полей (в&nbsp;разных панелях управления названия полей могут отличаться):

   - Хост — имя записи в&nbsp;формате `ваш_логин.xxx._domainkey`.
   - Значение — текст публичного ключа формата `v=DKIM1; k=rsa;p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A…`, который вы скопировали.<br/><br/>

   :::tip Важно
   Обратите внимание, что в некоторых панелях управления DNS для публичного ключа DKIM необходимо также указывать домен, например `ваш_логин.xxx._domainkey.ваш_домен.ru` — это зависит от самой панели управления, следуйте внутренним инструкциям.
   :::

4. Проверьте наличие созданной записи в DNS-зоне домена. Перейдите в [**API-консоль**](https://app.sendsay.ru/api/console) и введите запрос:

   ```js
   {
      "action": "issue.dkim.check",
      "id": номер dkim-ключа
   }
   ```

   где `номер dkim-ключа` — номер вашего DKIM-ключа, полученный в п. 1.

   Если в ответе параметр `onmoderation` имеет значение `1`, значит DKIM-подпись **не прошла проверку**. В таком случае в параметре `errors`, будет указан список ошибок — исправьте их и повторите проверку.

   Если же параметр `onmoderation` имеет значение `0`, значит **проверка прошла успешно** — и система автоматически начнёт подписывать письма вашей DKIM-подписью.

</TabItem>
</Tabs>

:::tip Важно
DNS-серверы обновляются до суток, поэтому ключ может быть обнаружен не сразу — в таком случае повторите проверку спустя некоторое время.
:::

После подключения домена вы также можете самостоятельно настроить, какие серверы могут отправлять рассылки от имени вашего домена — для этого нужно настроить:

- [SPF-запись](https://docs.sendsay.ru/email-campaigns/settings/email-authentication/#как-самостоятельно-настроить-spf-запись) `v=spf1 include:spf.sendsay.ru ~all`,
- [DMARC-политику](https://docs.sendsay.ru/email-campaigns/settings/email-authentication/#как-самостоятельно-настроить-dmarc-политику).

Если вы впервые слышите о DKIM, SPF и DMARC, прочитайте нашу короткую статью:

[Из чего состоит email-аутентификация](https://docs.sendsay.ru/email-campaigns/settings/email-authentication) <br/>

## Как заказать полную настройку email-аутентификации

1. Зарегистрируйте домен третьего уровня (это домен вида email.вашдомен.ru) или ниже.

2. Передайте права на управление поддоменом в личном кабинете вашего хостинг-провайдера.

[Как передать права на управление поддоменом](https://docs.sendsay.ru/email-campaigns/settings/how-to-delegate-subdomain) <br/>

3. <SupportLink>Напишите в чат поддержки</SupportLink>, что хотите провести полную настройку домена, — вам выставят счёт. После проверки NS-записей и оплаты счёта наши специалисты настроят:

- DKIM-подпись,
- SPF-подпись,
- DMARC-политику,
- проведут дополнительную настройку домена.

:::tip Важно
При настройке DMARC-политики мы по умолчанию настраиваем самую строгую политику (reject). Если вы хотите использовать более свободный вариант, напишите об этом нам.
:::

Если вы впервые слышите о DKIM, SPF и DMARC, прочитайте нашу короткую статью:

[Из чего состоит email-аутентификация](https://docs.sendsay.ru/email-campaigns/settings/email-authentication) <br/>
